name: Admin Desktop CI

on:
  workflow_dispatch:
  push:
    branches: [ "main" ]
    paths:
      - 'AdminSide/**'

jobs:
  build-windows:
    runs-on: windows-latest

    defaults:
      run:
        working-directory: ./AdminSide

    steps:
    - uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.0.x 

    # –î–û–î–ê–ù–û: –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∫–ª–∞—Å–∏—á–Ω–∏–π NuGet.exe
    - name: Setup NuGet
      uses: NuGet/setup-nuget@v2

    # –í–ò–ü–†–ê–í–õ–ï–ù–û: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ nuget restore –∑–∞–º—ñ—Å—Ç—å dotnet restore
    # –¶–µ —Å—Ç–≤–æ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ (Name.Version), —è–∫—É –≤–∏–º–∞–≥–∞—î —Ç–≤—ñ–π –ø—Ä–æ–µ–∫—Ç
    - name: Restore Packages (Legacy)
      run: nuget restore USRest_Admin.sln

    # –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –±–µ–∑ –∑–º—ñ–Ω (–¥–æ–¥–∞—î–º–æ --no-restore, —â–æ–± –≤—ñ–Ω –Ω–µ –Ω–∞–º–∞–≥–∞–≤—Å—è –ø–µ—Ä–µ—Ä–æ–±–∏—Ç–∏ –ø–∞–ø–∫–∏ –ø–æ-—Å–≤–æ—î–º—É)
    - name: Publish EXE
      run: dotnet publish USRest_Admin/USRest_Admin.csproj -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true -o ./publish --no-restore

    - name: Zip Build
      run: |
        Compress-Archive -Path ./publish/* -DestinationPath AdminPanel.zip

    - name: Send to Telegram
      if: success()
      run: |
        curl -v -F "chat_id=${{ secrets.TELEGRAM_TO }}" `
             -F "caption=üñ• Admin Panel Build Success!" `
             -F "document=@AdminPanel.zip" `
             https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendDocument