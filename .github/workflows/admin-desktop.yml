name: Admin Desktop CI

on:
  workflow_dispatch:
  push:
    branches: [ "main" ]
    paths:
      - 'AdminSide/**'

jobs:
  build-windows:
    runs-on: windows-latest

    defaults:
      run:
        working-directory: ./AdminSide

    steps:
    - uses: actions/checkout@v4

    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v2

    - name: Setup NuGet
      uses: NuGet/setup-nuget@v2

    - name: Restore Packages
      run: nuget restore USRest_Admin.sln

    - name: Build Solution
      run: msbuild USRest_Admin.sln /p:Configuration=Release /p:Platform="Any CPU"

    - name: Zip Build
      run: |
        # Переходимо в папку, куди MSBuild склав готові файли
        cd USRest_Admin/bin/Release
        # Запаковуємо все, що там є
        Compress-Archive -Path * -DestinationPath ..\..\..\AdminPanel.zip

    - name: Send to Telegram
      if: success()
      run: |
        curl -v -F "chat_id=${{ secrets.TELEGRAM_TO }}" `
             -F "caption= Admin Panel (MSBuild) Success!" `
             -F "document=@AdminPanel.zip" `
             https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendDocument