name: Admin Desktop CI

on:
  workflow_dispatch:
  push:
    branches: [ "main" ]
    paths:
      - 'AdminSide/**'

jobs:
  build-windows:
    runs-on: windows-latest # Обов'язково Windows

    defaults:
      run:
        working-directory: ./AdminSide

    steps:
    - uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.0.x 

    - name: Restore
      run: dotnet restore USRest_Admin.sln --packages ./packages

    # Публікуємо в один файл (SingleFile), щоб було зручніше
    - name: Publish EXE
      run: dotnet publish USRest_Admin/USRest_Admin.csproj -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true -o ./publish --no-restore
    # Запаковуємо в ZIP (Telegram любить архіви більше, ніж exe)
    - name: Zip Build
      run: |
        Compress-Archive -Path ./publish/* -DestinationPath AdminPanel.zip

    # Відправка в Telegram
    - name: Send to Telegram
      if: success()
      run: |
        curl -v -F "chat_id=${{ secrets.TELEGRAM_TO }}" `
             -F "caption= Admin Panel Build Success!" `
             -F "document=@AdminPanel.zip" `
             https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendDocument